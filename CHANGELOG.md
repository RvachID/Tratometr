# Changelog — Тратометр
## В планах
- «Режим лимита»: на старте ввод «Предполагаемые траты (в тыс.)», на скане — «До лимита: {лимит – сумма}» (уход в минус подсвечивать красным).
- История и статистика (неделя/месяц), экспорт/импорт.
- Улучшение OCR-логики: приоритет «самой крупной цифры», а не только высоты символа.
## [0.4.0] - 2025-08-17
### Added
- Серверные сессии покупок: таблица `purchase_session`, связь `price_entry.session_id`.
- Восстановление активной сессии при перезаходе; панель на главной с кнопками **Продолжить / Закончить / Удалить**.
- Компонент `PurchaseSessionService` (`Yii::$app->ps`) с авто-закрытием сессии после 3 часов неактивности.

### Changed
- Экран сканирования: больше не зависит от PHP-сессии; выборка и итог строятся по `session_id`.
- Все create/update/delete записей жёстко привязаны к активной серверной сессии.

### Removed
- Клиентская `shopSession`, таймауты `ASK/RESET` и модалка «продолжить?».

### Security / Auth
- Переход с PIN на хешированный пароль (`password_hash`), обновлены формы регистрации/входа/смены пароля.

### Fixed
- Пропадание позиций после F5 на скане.
- Необновление итога «на лету» (исправлен селектор и JSON-ответы `scan/update`, `scan/delete`).
- Несогласованность пересчёта при изменении `qty/amount`.

### Migrations
- `m250815_000001_replace_pin_with_password_hash` — добавлен `password_hash`, удалён `pin_code`.
- `m250817_000001_purchase_session_and_link` — добавлена таблица `purchase_session`, колонка `price_entry.session_id`.
> Примечание: разово привяжи осиротевшие `price_entry` к активным сессиям SQL-скриптом (см. тред).
## [0.3.0] — UX/стиль, цитаты, версия (текущая)
### Added
- Отдельная таблица `quotes` + вывод случайной цитаты на главной (малый кегль), защита от повторов подряд через сессию.
- Футер с ручной версией приложения из `params.php` (`'version' => '0.3.0'`).

### Changed
- Тёплая «бронзово-металлическая» шапка: градиент `#7C4F35 → #C19A6B` (перебивает `.navbar-dark.bg-dark`).
- Единая цветовая тема: золотистые акценты для `btn-outline-secondary`, заголовков и цитаты.
- Цвет фокуса инпутов/селектов под тему (бордер и glow в золотистой гамме).
- Заголовки и тексты приведены к минималистичному стилю.

### Fixed
- Правильная видимость управляющих элементов (кнопки «Скан», «Переснять») в разных режимах.

---

## [0.2.1] — Поведение модалок и камеры
### Added
- Автовозврат кнопок «Скан» и «Переснять» при открытии камеры.
- Скрытие «Скан» и «Переснять» в модалке ручного ввода.

### Changed
- Кнопка «Открыть/Закрыть камеру» корректно меняет текст; при ошибке открытия камера скрывается, `manualBtn` снова доступна.

---

## [0.2.0] — Сессии, заголовки, фильтры
### Added
- Сессия магазина/категории на скане; редирект на старт при отсутствии сессионных данных.
- Таймауты: `ASK_THRESHOLD_SEC` (модалка «продолжить?») и `RESET_THRESHOLD_SEC` (сброс сессии с редиректом).
- Заголовок «Покупаем: {категория}. В магазине: {магазин}» (уменьшенный кегль, обновляется по `hidden.bs.modal`).
- JS читает `data-store` / `data-category` из `#scan-root` + `updateScanTitle()`.

### Fixed
- Фильтрация: на экране сканирования отображаются и суммируются только записи **текущей сессии**.
- Исправлен пересчёт итога при изменении `qty`/удалении — больше не затрагиваются записи вне сессии.

---

## [0.1.2] — Точечные фиксы
### Fixed
- Стабильность работы сканера: корректная инициализация/остановка стрима, сброс предпросмотра фото.
- Мелкие правки верстки (камера, отступы), чтобы элементы не срезались.

---

## [0.1.1] — Ручной ввод
### Added
- Модалка ручного ввода: предзаполнение значений, сброс заметки и предпросмотра фото, единый форматтер сумм.

---

## [0.1.0] — MVP
### Added
- Стартовая («Тратометр») с переходом на `site/scan`.
- Экран сканирования: открытие/закрытие камеры, парсинг суммы, добавление позиции, список последних позиций.
- На главной (для авторизованных) — последние записи пользователя (до 20) и итог по ним.
- Базовая авторизация + редирект гостя на `auth/login`.

---
